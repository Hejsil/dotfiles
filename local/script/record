#!/bin/execlineb -P

foreground { sudo setcap cap_sys_admin+ep "/usr/bin/gsr-kms-server" }

backtick date { date "+%y-%m-%dT%H-%M-%S" }
backtick sink { pactl get-default-sink }
backtick source { pactl get-default-source }

multisubstitute {
    importas date   date
    importas sink   sink
    importas source source
    importas home   HOME
}

foreground { echo "${home}/video/${date}.mp4" }
gpu-screen-recorder -w DisplayPort-0 -q ultra -f 60
    -o "${home}/video/${date}.mp4" -a "${sink}.monitor" -a "${source}"
