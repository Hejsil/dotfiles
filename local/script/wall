#!/bin/execlineb -S1

define wallpapers_on_screen "/tmp/wallpapers-on-screen"
backtick -E monitors { mktemp "/tmp/wall.monitors.XXXXXXXX" }
backtick -E wallpapers { mktemp "/tmp/wall.wallpapers.XXXXXXXX" }

foreground { redirfd -w 1 $monitors monitors name }
foreground {
    pipeline { fd . $1 --type f }
    redirfd -w 1 $wallpapers sort -R
}

foreground {
    pipeline { paste $monitors $wallpapers }
    redirfd -w 1 $wallpapers_on_screen grep -v "^\\s"
}

foreground { rm $monitors $wallpapers }
foreground {
    pipeline { redirfd -r 0 $wallpapers_on_screen tr "\\t" "\\n" }
    xargs "-d\n" -P 0 -n2 mpvpaper -p -o "--pause --force-window=no"
}


