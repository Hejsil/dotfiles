#!/bin/nawk -f

# We are inside a comment. Don't autocomplete in here
/^.*\/\// { printf "%s¤", $0; next }

# We are inside a string. Don't autocomplete in here
/^([^"]*"(\\"|[^"])*")*[^"]*"(\\"|[^"])+$/ { printf "%s¤", $0; next }

# We are inside a char. Don't autocomplete in here
/^([^']*'(\\'|[^'])*')*[^']*'(\\'|[^'])+$/ { printf "%s¤", $0; next }

$NF == "if"  { $NF = "if";     printf "%s ¤ {  }", $0 ; next }
$NF == "for" { $NF = "for";    printf "%s item ¤ {  }", $0 ; next }

$NF ~ /\.lock\($/ { printf "%s).unwrap()¤", $0 ; next }

$NF ~ /\{$/ { printf "%s¤}", $0 ; next }
$NF ~ /\($/ { printf "%s¤)", $0 ; next }
$NF ~ /\[$/ { printf "%s¤]", $0 ; next }

$NF ~ /(^|[^\\])"$/ { printf "%s¤\"", $0 ; next }
$NF ~ /(^|[^\\])'$/ { printf "%s¤'", $0 ; next }

{printf "%s¤", $0}

