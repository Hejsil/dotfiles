#!/bin/execlineb -P
pipeline { bspc subscribe report }
stdbuf -o L sed -E
    # This sed is a very hacky way of turning the 'bspc report' output into a json
    # Add ' }' to the end of our string
    -e "s#$#\" }#"

    # 'W[Mm]<monitor_name>:' -> '{ \"<monitor_name\": \"'
    -e "s#W[mM]([^:]*):#{ \"\\1\": \"#g"

    # ':[Mm]<monitor_name>:' -> ', \"<monitor_name\": \"'
    -e "s#:[mM]([^:]*):#\", \"\\1\": \"#g"

    # This is the focused workspace. Give it some special pango markup
    # '([OF]\d+)' -> '<i><b>$1</b></i>'
    -e "s#([OF][0-9]+)#<i><b>\\1</b></i>#g"

    # Workspaces that are occupied by one or more windows
    # '[oO](\d+)' -> ' $1*'
    -e "s#[oO]([0-9]+)# \\1*#g"

    # Workspaces that are empty
    # '[fF](\d+)' -> ' $1 '
    -e "s#[fF]([0-9]+)# \\1 #g"

    # Remove leftover ':'
    -e "s#([^\"]):#\\1#g"

    # Remove the things we don't care about. See bspc man page "REPORT FORMAT". The last 3 entries
    # we're gonna remove.
    -e "s#[LTMPF=@GSM]*\"([, ])#\"\\1#g"
