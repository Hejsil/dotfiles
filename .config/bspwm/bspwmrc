#!/bin/sh

#### Colors ####

SCHEME="$HOME/.local/script/colors.sh"
eval "$(cat "$SCHEME")"

#### bspwm config ####

bspc rule -r "*"

for MONITOR in $(bspc query -M --names); do
    bspc monitor "$MONITOR" -d 1 2 3 4 5 6 7 8 9 0
done

bspc config normal_border_color "#$COLOR1"
bspc config active_border_color "#$COLOR2"
bspc config focused_border_color "#$COLOR4"

# Idk what these are. Use a weird color until i figure it out
bspc config presel_feedback_color "#$COLOR8"

bspc config split_ratio           0.55
bspc config border_width          1
bspc config window_gap            0
bspc config focus_follows_pointer true

bspc rule -a MEGAsync desktop=^10

#### Language ####

setxkbmap -layout "dk"

#### Generate symlinks ####

ln -s "$HOME/.local/script/open.sh" "$HOME/.local/script/xdg-open"

#### Generate themes #####

mkfile() {
    mkdir -p "$(dirname "$1")"
    touch "$1"
    echo "$1"
}

TEMPLATE_DIR="$HOME/.local/share/template"
base16.sh "$SCHEME" "$TEMPLATE_DIR/alacritty.yml" > "$(mkfile "$HOME/.config/alacritty/alacritty.yml")" &
base16.sh "$SCHEME" "$TEMPLATE_DIR/dunstrc" > "$(mkfile "$HOME/.config/dunst/dunstrc")" &
base16.sh "$SCHEME" "$TEMPLATE_DIR/.gtkrc-2.0" > "$(mkfile "$HOME/.gtkrc-2.0")" &
base16.sh "$SCHEME" "$TEMPLATE_DIR/gtk.css" > "$(mkfile "$HOME/.config/gtk-3.0/gtk.css")" &
base16.sh "$SCHEME" "$TEMPLATE_DIR/theme.rasi" > "$(mkfile "$HOME/.config/rofi/theme.rasi")" &
base16.sh "$SCHEME" "$TEMPLATE_DIR/settings.json" > "$(mkfile "$HOME/.config/VSCodium/User/settings.json")" &
base16.sh "$SCHEME" "$TEMPLATE_DIR/.Xresources" > "$(mkfile "$HOME/.Xresources")" &
wait
gtkrc-reload

#### Auto start ####

# programs we run on startup and never restart
runonce.sh megasync
runonce.sh minidlnad -S -f "/home/$USER/.config/minidlna/minidlna.conf" -P "/home/$USER/.config/minidlna/minidlna.pid"
runonce.sh transmission-daemon -f
runonce.sh redshift
runonce.sh sxhkd -r /tmp/sxhkd.log

# programs we restart when we restart the wm
restart.sh wall.sh "$HOME/MEGA/Pictures/Wallpapers"
restart.sh bar.sh
restart.sh dunst

#### Reload ####

echo "$HOME/.config/sxhkd/sxhkdrc" | restart.sh entr -p pkill -USR1 -x sxhkd
(
    echo "$HOME/.config/bspwm/bspwmrc"
    echo "$HOME/.local/script/bar-info.sh"
    echo "$HOME/.local/script/bar-mk.sh"
    echo "$HOME/.local/script/bar.sh"
    echo "$HOME/.local/script/base16.sh"
    echo "$HOME/.local/script/restart.sh"
    echo "$HOME/.local/script/runonce.sh"
    echo "$SCHEME"
    find "$TEMPLATE_DIR"
) | restart.sh entr -p bspc wm -r
