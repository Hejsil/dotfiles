#!/bin/sh

for MONITOR in $(bspc query -M --names); do
    bspc monitor "$MONITOR" -d 1 2 3 4 5 6 7 8 9 0
done

bspc config border_width         3
bspc config window_gap           10

bspc config split_ratio          0.55
bspc config borderless_monocle   true
bspc config gapless_monocle      true

setxkbmap -layout "dk"
ln -s "$HOME/.local/script/open.sh" "$HOME/.local/script/xdg-open"

# Generate themes. Having this here, allows us to hot reload themes which is nice
SCHEME="$HOME/colors.yaml"
ALACRITTY_TEMPLATE="$HOME/templates/alacritty.yml"
ROFI_TEMPLATE="$HOME/templates/theme.rasi"
VSCODIUM_TEMPLATE="$HOME/templates/settings.json"
XRESOURCES_TEMPLATE="$HOME/templates/.Xresources"
base16.sh "$SCHEME" "$ALACRITTY_TEMPLATE" > "$HOME/.config/alacritty/alacritty.yml" &
base16.sh "$SCHEME" "$VSCODIUM_TEMPLATE" > "$HOME/.config/VSCodium/User/settings.json" &
base16.sh "$SCHEME" "$ROFI_TEMPLATE" > "$HOME/.config/rofi/theme.rasi" &
base16.sh "$SCHEME" "$XRESOURCES_TEMPLATE" > "$HOME/.Xresources"

# programs we run on startup and never restart
runonce.sh megasync
runonce.sh sxhkd -r /tmp/sxhkd.log

# programs we restart when we restart the wm
# TODO: runone.sh does not work on runnable scripts. They have to be invoked by
#       /bin/sh for it to work correctly
restart.sh wall.sh
restart.sh bar.sh

restart.sh dunst

# reload sxhkd config when it changes
echo "$HOME/.config/sxhkd/sxhkdrc" | restart.sh entr -p pkill -USR1 -x sxhkd

# restart wm when certain configs changes
(
    echo "$HOME/.config/bspwm/bspwmrc"
    echo "$HOME/.local/script/bar-info.sh"
    echo "$HOME/.local/script/bar-mk.sh"
    echo "$HOME/.local/script/bar.sh"
    echo "$HOME/.local/script/base16.sh"
    echo "$HOME/.local/script/restart.sh"
    echo "$HOME/.local/script/runonce.sh"
    echo "$SCHEME"
    echo "$ALACRITTY_TEMPLATE"
    echo "$VSCODIUM_TEMPLATE"
    echo "$ROFI_TEMPLATE"
    echo "$XRESOURCES_TEMPLATE"
) | restart.sh entr -p bspc wm -r
